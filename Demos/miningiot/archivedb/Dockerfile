FROM amirsamary/irisdemo:irisdemodb
LABEL maintainer="Amir Samary <amir.samary@intersystems.com>"

# Name of the project folder ex.: my-atelier-project
ARG IRIS_PROJECT_FOLDER_NAME

# Adding source code that will be loaded by the installer
ADD ./${IRIS_PROJECT_FOLDER_NAME}/ $IRIS_APP_SOURCEDIR

# This is where we will be generating the files to be used DURING the demo
# I am now creating this directory from inside IRIS because I was having weird permission
# problems with the irisusr user. It seems the problems I was having is related to the fact
# that I am sharing a volume between two containers (archivedb and iotmon).
# There is a thread on the docker community about it here:
# https://forums.docker.com/t/ls-cannot-open-directory-permission-denied/48120
#
# RUN mkdir /to_iotmon && chown irisusr:irisusr /to_iotmon && chmod 666 /to_iotmon

# This is where we will be putting the files to be loaded as archive
RUN mkdir /tmp/data_files && chown root:irisusr /tmp/data_files && chmod 666 /tmp/data_files

# This file will be loaded into the APP namespace and deleted by the IRISConfig.Installer
# These files were autogenerated by a python script written by NITOR
# I opened each of them to convert them from CR/LF to LF and compressed them into a
# single tar.gz file so we can upload this to GitHub without issues. It will only be
# decompressed by the Docker ADD command while adding it to the image:
# TODO: Joel
#ADD ./transformer_signals.tar.gz /tmp/data_files/

# Running the IRISConfig.Installer. This will load the source from our project and
# load the csv files with the data into the database
RUN /usr/irissys/demo/irisdemoinstaller.sh

# Cleanning up
RUN rm -rf /tmp/data_files